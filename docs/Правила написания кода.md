---
sidebar_position: 2
---

# Правила написания кода

Качество программы начинается с качества ее исходного кода. Основным фактором качества исходного кода программы является его читаемость и понятность. Необходимо формализовать правила написания кода, которые сделают чужой код читабельнее и понятнее. Правила форматирования кода должны быть едиными во всем проекте. И крайне желательно, чтобы они были очень похожими между проектами.

## 1. Форматирование кода 

### 1.1. Структурирование текста 

#### 1.1.1. Длина строки
Нужно стараться избегать строк длинной более 200 символов. Если строка превышает этот размер, то нужно использовать правила переноса строки.

#### 1.1.2. Правила переноса строки
Если длина строки превышает 120 символов, то необходимо пользоваться следующими правилами переноса:
- переносить можно после запятой или перед оператором;
- переносимая строка должна быть сдвинута относительно верхней на один символ табуляции;
- переносы должны быть в стиле UNIX. 

```php title="Пример 1"
$arAuthResult = $USER->ChangePassword($USER_LOGIN, $USER_CHECKWORD, $USER_PASSWORD, $USER_CONFIRM_PASSWORD, $USER_LID);

//допустимым будет следующий вариант переноса 
$arAuthResult = $USER->ChangePassword($USER_LOGIN, $USER_CHECKWORD, 
	$USER_PASSWORD, $USER_CONFIRM_PASSWORD, $USER_LID);
```

```php title="Пример 2"
if(COption::GetOptionString("main", "new_user_registration", "N")=="Y" && $_SERVER['REQUEST_METHOD']=='POST' && $TYPE=="REGISTRATION" && (!defined("ADMIN_SECTION") || ADMIN_SECTION!==true))

//допустимым будет следующий вариант переноса 
if (COption::GetOptionString("main", "new_user_registration", "N") == "Y" 
	&& $_SERVER['REQUEST_METHOD'] == 'POST' && $TYPE == "REGISTRATION" 
	&& (!defined("ADMIN_SECTION") || ADMIN_SECTION !== true))
```

#### 1.1.3. Пробелы и табуляция 
Для форматирования отступов в коде нужно использовать табуляцию. Использование пробелов запрещено. Причины:
- в случае использования табуляции каждый может настроить в своем редакторе желаемый отступ; 
используется один символ вместо нескольких; 
- в случае смешивания пробелов и табуляции текст будет прыгать, разрушая форматирование.

#### 1.1.4. Форматирование подчиненности 
Подчиненный код должен быть сдвинут от главного ровно на один символ табуляции. Подчиненный код не может находиться на той же строке, что и главный. Отступ более чем пятого уровня может служить указанием, что код стоит вынести в отдельный блок. 

```php title="Пример"
function func()
{ 
	if (condition)
	{ 
		while (condition2)
		{
			...
		} 
	} 
}
```

#### 1.1.5. Правила расстановки фигурных скобок 
Открывающая скобка должна ставится под соответствующим оператором и на одном отступе с ним. Закрывающая скобка должна ставится под соответствующей открывающей. 

```php title="Пример"
if ($condition) 
{
	... 
}
```

#### 1.1.6. Использование тернарного оператора "?:" 
По возможности, действия, производимые по условию, должны быть простыми функциями. Если весь блок ветвления плохо читается, то стоит заменить его на if/else.

```php title="Пример"
условие ? funct1() : func2();
```

### 1.2. Инструкции, выражения 

#### 1.2.1. Выражения 
Желательно, чтобы в каждой строчке присутствовало только одно выражение.

```php title="Пример. Неправильно писать так"
$a = $b; $b = $c; $c = $a;
```

```php title="Пример. Правильно писать так"
$a = $b; 
$b = $c; 
$c = $a; 
```

#### 1.2.2. Инструкции "if", "else", "while" и т.п. 
При написании инструкций должно строго применяться правило Форматирование подчиненности: тело инструкции должно быть сдвинуто на один символ табуляции вправо от самой инструкции.

```php title="Пример. Неправильно писать так"
if ($a == 0) $a = 10; 
else{ 
$a = 5; 
$b = 10;}
```

```php title="Пример. Правильно писать так"
if ($a == 0)
{ 
	$a = 10; 
}
else
{ 
	$a = 5; 
	$b = 10; 
} 
```

#### 1.2.3. Сложные инструкции 
Сложные инструкции следует разбивать по строкам.

```php title="Пример"
if(COption::GetOptionString("main", "new_user_registration", "N")=="Y" && $_SERVER['REQUEST_METHOD']=='POST' && $TYPE=="REGISTRATION" && (!defined("ADMIN_SECTION") || ADMIN_SECTION!==true)) 

//Можно записать как: 
if (COption::GetOptionString("main", "new_user_registration", "N") == "Y" 
	&& $_SERVER['REQUEST_METHOD'] == 'POST' && $TYPE == "REGISTRATION" 
	&& (!defined("ADMIN_SECTION") || ADMIN_SECTION !== true)) 
{
	...
}
```

Очень сложные инструкции рекомендуется разбивать на несколько более простых. 
```php title="Пример" 
if((!(defined("STATISTIC_ONLY") && STATISTIC_ONLY && substr($APPLICATION->GetCurPage(), 0,
	strlen(BX_ROOT."/admin/"))!=BX_ROOT."/admin/")) && COption::GetOptionString("main", "include_charset", "Y")=="Y"
	&& strlen(LANG_CHARSET)>0) 

//Можно записать так: 
$publicStatisticOnly = false; 
if (
	defined("STATISTIC_ONLY") 
	&& STATISTIC_ONLY 
	&& substr($APPLICATION->GetCurPage(), 0, 
	strlen(BX_ROOT."/admin/")) != BX_ROOT."/admin/")
	{ 
 		$publicStatisticOnly = true; 
	}
if (!$publicStatisticOnly && strlen(LANG_CHARSET) > 0  && COption::GetOptionString("main", "include_charset", "Y") == "Y") 
{ 
}

//или так:
if (!defined("STATISTIC_ONLY") || ! STATISTIC_ONLY  || substr($APPLICATION->GetCurPage(), 0,
strlen(BX_ROOT."/admin/")) == BX_ROOT."/admin/")
{
	if (strlen(LANG_CHARSET) > 0 &&
		COption::GetOptionString("main", "include_charset", "Y") == "Y")
	{
	}
}
```

#### 1.2.4. Форматирование массивов
Массивы, которые записываются в несколько строк, следует форматировать следующим образом:

```php title="Пример"
$arFilter = [ 
	"key1" => "value1", 
	"key2" => [ 
		"key21" => "value21", 
		"key22" => "value22",
	] 
];
```

### 1.3. Пустые строки и пробелы 

#### 1.3.1. Пустые строки 
Пустые строки помогают разбивать код приложения на логические сегменты. Несколькими строками могут отделяться секции в исходном файле. Одной пустой строкой отделяются друг от друга методы и логические секции внутри метода для более удобного чтения.
Перед логической секцией рекомендуется вставить комментарий, в котором будет указано назначение этой секции (см. пункт 3).

#### 1.3.2. Пробелы 
После запятой должен быть пробел. После точки с запятой, если она не последняя в строке (например, в инструкции for), должен быть пробел. Перед запятой или точкой с запятой пробелы не ставятся. Все операторы должны быть отделены пробелом от операндов с обеих сторон. Замена пробела символом табуляции не допускается. 

**Пояснения:**
Один пробел используется в объявлении методов после запятой, но не перед скобками:

```php title="Пример правильного использования"
TestMethod($a, $b, $c); 
```

```php title="Пример неправильного использования"
TestMethod($a,$b,$c); 
TestMethod( $a, $b, $c ); 
```

Так же одиночный пробел используют для выделения операторов:

```php title="Пример правильного использования"
$a = $b * $c / $d;
```

```php title="Пример неправильного использования"
$a=$b*$c/$d;
```

Также пробелы используются при форматировании циклов:

```php title="Пример правильного использования"
for ($i = 0; $i < 10; $i++)
```

```php title="Пример неправильного использования"
for($i=0;$i<10;$i++)
```

:::info Примечание
Присутствие или отсутствие пробела после операторов for, if и других правилами не регламентируется. 
:::

Табуляция всегда используется для отступов, но никогда не используется вместо пробелов. 

```php title="Пример не правильного форматирования (символ табуляции обозначен стрелкой)"
$arArray = [ 
	"key1" =>→"value1", 
	"key2" =>→"value2", 
];
```

### 1.4. Прочее 
В сложных выражениях рекомендуется группировать операции с помощью скобок вне зависимости от того, требует это приоритет операций или нет.

```php title="Пример неправильного использования"
$r = $a + ($b * $c);
```

## 2. Соглашение об именовании

### 2.1. Общие понятия
Не используйте подчеркивание для отделения слов внутри идентификаторов, это удлиняет идентификаторы и затрудняет чтение. 
Старайтесь давать переменным, методам и пр. "говорящие" названия. Предпочтительно использовать имена, которые ясно и четко описывают предназначение и/или смысл сущности. 
Старайтесь делать имена идентификаторов как можно короче (но не в ущерб читабельности). 
Если в имени содержится аббревиатура, лучше вместо всех заглавных оставить только первую букву заглавной, а остальные написать строчными. Т.е. лучше задать имя `getHtmlStatistic`, а не `getHTMLStatistic`. 

### 2.2. Именование переменных 
Первое логическое слово должно начинаться с маленькой буквы, остальные логические слова - с большой. Имена переменных могут иметь префиксы, если требуется явно указать тип переменной: `ar` - для массивов,`rs` = для объекта результата, `db` - для наборов данных из базы и т.п.

Из названия переменной должно быть понятно, ее семантическое и количественное содержание. Например, `$arItem` предполагает массив данных, описывающий элемент. А `$arItems` - список таких элеменов.

```php title="Пример"
$testCounter;
$userPassword;

$rsItems = CIBlockElement::GetList();
while ($arItem = $rsItems->Fetch())
{
}
```

### 2.3. Именование методов 
Очевидность из названия действия, которое будет совершать функция\метод. 
Использование префиксов: `is` (обозначение вопроса), `get` (получить значение), `set` (установить значение).

```php title="Пример"
isFileWriteable();
```

### 2.4. Именование классов
В имени должна обозначаться сущность, описываемая классом. В имени должно быть не более трех слов. 
Нельзя использовать знак подчеркивания ('_'). 
В качестве разделителей слов в имени следует использовать заглавные буквы, строчные - для остальной части.

```php title="Пример"
class SaleAffiliateAccount
```

## 3. Комментарии 
Желательно добавлять комментарии в код, особенно для сложных констуркций и блоков кода. Комментарий должны носить содержательный характер. 

### 3.1. PHPDoc 
Желательно описывать в стиле PHPDoc все классы и их публичные методы. 

```php title="Пример"
/**
 * @param string $msg string to output
 * @return string unchanged
 */
function foo($msg = '')
{
	return $msg;
}
```

## 4. Другое 

### 4.1. Магические числа 
В коде не должно быть магических чисел.

```php title="Пример плохого кода"
$task->Update($taskId, ['STATUS' => 3], 1);
```

```php title="Пример хорошего кода"
$task->Update($taskId, ['STATUS' => CTaskStatus::New], TASK_PERMISSIONS_WRITE); 
```

### 4.2. Дублирование кода
В коде не должно быть повторяющихся кусков кода. Если один и тот же код нужно использовать в нескольких местах, лучше его вынести в отдельную функцию или метод класса и преиспользовать.

## 5. Битрикс

### 5.1. D7 или старое ядро
При написании кода на Битриксе рекомендуется пользоваться методами нового ядра D7 где это возможно.

```php title="Пример"
//Старое ядро
CModule::IncludeModule('iblock');
CModule::IncludeModuleEx('ewp.sitemap');

//D7
use \Bitrix\Main\Loader;

Loader::includeModule('iblock');
Loader::includeSharewareModule('ewp.sitemap');
```